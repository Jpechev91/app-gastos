<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Control de Gastos por Voz</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f9fafb;
    transition: background 0.5s ease;
  }
  h1 {
    text-align: center;
  }
  .btn {
    background: #4f46e5;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px;
    user-select: none;
  }
  table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }
  .total {
    font-weight: bold;
    margin-top: 10px;
  }
</style>
</head>
<body>
<h1>üìä Control de Gastos por Voz</h1>

<div>
  <button class="btn" id="voiceBtn">üéôÔ∏è Mant√©n para hablar</button>
</div>

<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Categor√≠a</th>
      <th>Monto</th>
      <th>Notas</th>
    </tr>
  </thead>
  <tbody id="gastosBody"></tbody>
</table>
<p class="total">Total del mes: $<span id="total">0</span></p>

<script>
let recognition;
let gastos = JSON.parse(localStorage.getItem('gastos')) || [];
const coloresPastel = {
  rosa: "#ffd1dc",
  azul: "#aee6f9",
  verde: "#b8f2b8",
  amarillo: "#fff5ba",
  lila: "#e5ccff",
  durazno: "#ffdab9"
};

function renderGastos() {
  const tbody = document.getElementById('gastosBody');
  tbody.innerHTML = '';
  let total = 0;
  gastos.forEach(g => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${g.fecha}</td><td>${g.categoria}</td><td>${g.monto}</td><td>${g.notas}</td>`;
    tbody.appendChild(tr);
    total += parseFloat(g.monto);
  });
  document.getElementById('total').textContent = total.toLocaleString();
  localStorage.setItem('gastos', JSON.stringify(gastos));
}

function iniciarVoz() {
  if (!('webkitSpeechRecognition' in window)) {
    alert('Tu navegador no soporta reconocimiento de voz. Usa Chrome.');
    return;
  }
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'es-ES';
  recognition.continuous = true;

  recognition.onresult = (event) => {
    const texto = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
    procesarEntradaVoz(texto);
  };

  recognition.start();
}

function detenerVoz() {
  if (recognition) recognition.stop();
}

function procesarEntradaVoz(texto) {
  // Cambiar fondo si menciona un color pastel
  for (let color in coloresPastel) {
    if (texto.includes(color)) {
      document.body.style.background = coloresPastel[color];
      return;
    }
  }

  // Registrar gasto: "20000 transporte bus"
  const partes = texto.split(' ');
  const monto = parseFloat(partes[0].replace(/\D/g, ''));
  if (isNaN(monto)) return;
  const categoria = partes[1] || 'Sin categor√≠a';
  const notas = partes.slice(2).join(' ');
  const fecha = new Date().toLocaleDateString();

  gastos.push({ fecha, categoria, monto, notas });
  renderGastos();
}

document.getElementById('voiceBtn').addEventListener('mousedown', iniciarVoz);
document.getElementById('voiceBtn').addEventListener('mouseup', detenerVoz);
document.getElementById('voiceBtn').addEventListener('mouseleave', detenerVoz);

renderGastos();
</script>
</body>
</html>
