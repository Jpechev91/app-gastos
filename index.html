<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Control de Gastos por Voz</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f9fafb;
    transition: background 0.5s ease;
  }
  h1 {
    text-align: center;
  }
  .btn {
    background: #4f46e5;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px;
    user-select: none;
  }
  .btn.active {
    background: #22c55e; /* Verde cuando est√° activo */
  }
  .color-btn {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    margin: 5px;
    cursor: pointer;
    font-weight: bold;
  }
  table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }
  .total {
    font-weight: bold;
    margin-top: 10px;
  }
  #debug {
    margin-top: 15px;
    padding: 10px;
    border: 1px solid #ccc;
    background: #fff;
    font-family: monospace;
    white-space: pre-wrap;
  }
</style>
</head>
<body>
<h1>üìä Control de Gastos</h1>

<div>
  <button class="btn" id="voiceBtn">üéôÔ∏è Activar micr√≥fono</button>
</div>

<!-- Depurador de voz -->
<div id="debug">
üé§ Texto detectado: <span id="textoCapturado">[A√∫n no hay datos]</span>
</div>

<!-- Botones de colores -->
<div>
  <button class="color-btn" style="background:#ffd1dc" onclick="cambiarFondo('#ffd1dc')">Rosa</button>
  <button class="color-btn" style="background:#aee6f9" onclick="cambiarFondo('#aee6f9')">Azul</button>
  <button class="color-btn" style="background:#b8f2b8" onclick="cambiarFondo('#b8f2b8')">Verde</button>
  <button class="color-btn" style="background:#fff5ba" onclick="cambiarFondo('#fff5ba')">Amarillo</button>
  <button class="color-btn" style="background:#e5ccff" onclick="cambiarFondo('#e5ccff')">Lila</button>
  <button class="color-btn" style="background:#ffdab9" onclick="cambiarFondo('#ffdab9')">Durazno</button>
</div>

<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Categor√≠a</th>
      <th>Monto</th>
      <th>Notas</th>
    </tr>
  </thead>
  <tbody id="gastosBody"></tbody>
</table>
<p class="total">Total del mes: $<span id="total">0</span></p>

<script>
let recognition;
let gastos = JSON.parse(localStorage.getItem('gastos')) || [];
let microfonoActivo = false;

function renderGastos() {
  const tbody = document.getElementById('gastosBody');
  tbody.innerHTML = '';
  let total = 0;
  gastos.forEach(g => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${g.fecha}</td><td>${g.categoria}</td><td>${g.monto}</td><td>${g.notas}</td>`;
    tbody.appendChild(tr);
    total += parseFloat(g.monto) || 0;
  });
  document.getElementById('total').textContent = total.toLocaleString();
  localStorage.setItem('gastos', JSON.stringify(gastos));
}

function iniciarVoz() {
  if (!('webkitSpeechRecognition' in window)) {
    alert('Tu navegador no soporta reconocimiento de voz. Usa Chrome.');
    return;
  }
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'es-ES';
  recognition.continuous = true;

  recognition.onresult = (event) => {
    const texto = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();

    // Mostrar en pantalla lo que se capta
    document.getElementById("textoCapturado").textContent = texto;
    console.log("Texto detectado:", texto);

    procesarEntradaVoz(texto);
  };

  recognition.start();
}

function detenerVoz() {
  if (recognition) recognition.stop();
}

function procesarEntradaVoz(texto) {
  let fecha = new Date().toLocaleDateString();
  let categoria = "Sin categor√≠a";
  let monto = null;
  let notas = "";

  // Buscar monto
  const montoMatch = texto.match(/(\d+([.,]\d+)?)/);
  if (montoMatch) monto = parseFloat(montoMatch[0].replace(",", "."));

  // Buscar fecha tipo "10 de agosto"
  const fechaMatch = texto.match(/(\d{1,2}\s+de\s+\w+)/);
  if (fechaMatch) fecha = fechaMatch[0];

  // Buscar categor√≠a despu√©s de "en"
  const categoriaMatch = texto.match(/en\s+([a-z√°√©√≠√≥√∫]+)/);
  if (categoriaMatch) categoria = categoriaMatch[1];

  // Notas despu√©s de "por"
  const notasMatch = texto.match(/por\s+(.+)/);
  if (notasMatch) notas = notasMatch[1];

  if (monto !== null && !isNaN(monto)) {
    gastos.push({ fecha, categoria, monto, notas });
    renderGastos();
  } else {
    console.warn("No se detect√≥ monto, no se agreg√≥ registro.");
  }
}

function cambiarFondo(color) {
  document.body.style.background = color;
}

// Bot√≥n tipo interruptor
document.getElementById('voiceBtn').addEventListener('click', () => {
  if (!microfonoActivo) {
    iniciarVoz();
    document.getElementById('voiceBtn').textContent = "üõë Desactivar micr√≥fono";
    document.getElementById('voiceBtn').classList.add("active");
    microfonoActivo = true;
  } else {
    detenerVoz();
    document.getElementById('voiceBtn').textContent = "üéôÔ∏è Activar micr√≥fono";
    document.getElementById('voiceBtn').classList.remove("active");
    microfonoActivo = false;
  }
});

renderGastos();
</script>
</body>
</html>
